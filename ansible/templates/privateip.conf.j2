{% set count = 1 %}
{% for n in range(ansible_all_ipv4_addresses|length) %}
{% if count == 1 %}
server app1 10.0.40.27:8000 source {{ ansible_all_ipv4_addresses[n] }}
server app2 10.0.40.27:8001 source {{ ansible_all_ipv4_addresses[n+1] }}
server app3 10.0.40.27:8002 source {{ ansible_all_ipv4_addresses[n+2] }}
server app4 10.0.40.27:8003 source {{ ansible_all_ipv4_addresses[n+3] }}
server app5 10.0.40.28:8000 source {{ ansible_all_ipv4_addresses[n+4] }}
server app6 10.0.40.28:8001 source {{ ansible_all_ipv4_addresses[n+5] }}
server app7 10.0.40.28:8002 source {{ ansible_all_ipv4_addresses[n+6] }}
server app8 10.0.40.28:8003 source {{ ansible_all_ipv4_addresses[n+7] }}
{{ contents }}
{% endif %}
{% set count = 2 %}
{% endfor %}